<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Settings — Authority Dashboard — SARAL</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/dashboard.css" />
  <link rel="stylesheet" href="css/authority.css" />
</head>
<body class="dash-body">

  <!-- ═══════ SIDEBAR ═══════ -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar__top">
      <a href="index.html" class="sidebar__logo">
        <svg width="28" height="28" viewBox="0 0 28 28" fill="none">
          <circle cx="14" cy="14" r="12" stroke="url(#sLogoG2)" stroke-width="2.5"/>
          <path d="M9 14.5L12.5 18L19 11" stroke="url(#sLogoG2)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          <defs><linearGradient id="sLogoG2" x1="0" y1="0" x2="28" y2="28"><stop stop-color="#4F8CFF"/><stop offset="1" stop-color="#A78BFA"/></linearGradient></defs>
        </svg>
        <span>SARAL</span>
        <span class="auth-badge">Authority</span>
      </a>
    </div>

    <nav class="sidebar__nav">
      <a href="authority.html" class="sidebar__link">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="2" y="2" width="7" height="7" rx="2" stroke="currentColor" stroke-width="1.5"/><rect x="11" y="2" width="7" height="7" rx="2" stroke="currentColor" stroke-width="1.5"/><rect x="2" y="11" width="7" height="7" rx="2" stroke="currentColor" stroke-width="1.5"/><rect x="11" y="11" width="7" height="7" rx="2" stroke="currentColor" stroke-width="1.5"/></svg>
        <span>Case Queue</span>
      </a>
      <a href="authority-analytics.html" class="sidebar__link">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M4 16V8M8 16V4M12 16v-5M16 16V9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        <span>Analytics</span>
      </a>
      <a href="authority-archive.html" class="sidebar__link">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M12 2H4a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V8l-6-6z" stroke="currentColor" stroke-width="1.5"/><path d="M12 2v6h6" stroke="currentColor" stroke-width="1.5"/></svg>
        <span>Reports Archive</span>
      </a>
      <a href="authority-settings.html" class="sidebar__link sidebar__link--active">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><circle cx="10" cy="10" r="3" stroke="currentColor" stroke-width="1.5"/><path d="M10 2v2M10 16v2M2 10h2M16 10h2M4.93 4.93l1.41 1.41M13.66 13.66l1.41 1.41M15.07 4.93l-1.41 1.41M6.34 13.66l-1.41 1.41" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        <span>Settings</span>
      </a>
    </nav>

    <div class="sidebar__profile">
      <div class="sidebar__profile-avatar" style="background: linear-gradient(135deg, #8B5CF6, #4F8CFF);">
        <span>TP</span>
      </div>
      <div class="sidebar__profile-info">
        <span class="sidebar__profile-name">Insp. T. Prasad</span>
        <span class="sidebar__profile-badge" style="color: var(--violet-500);">
          <svg width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M5 1l1.2 2.4L9 3.8 7 5.7l.5 2.8L5 7.3 2.5 8.5 3 5.7 1 3.8l2.8-.4L5 1z" fill="#8B5CF6"/></svg>
          Traffic Inspector
        </span>
      </div>
    </div>
    <button class="sidebar__logout" onclick="SaralAuth.signOut()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <span>Logout</span>
    </button>
  </aside>

  <!-- MOBILE HEADER -->
  <header class="dash-header" id="dashHeader">
    <button class="dash-header__toggle" id="sidebarToggle">
      <span></span><span></span><span></span>
    </button>
    <a href="index.html" class="dash-header__logo">SARAL Authority</a>
    <span></span>
  </header>

  <!-- MAIN -->
  <main class="dash-main">
    <div class="dash-greeting" data-reveal>
      <div>
        <h1 class="dash-greeting__title">Settings</h1>
        <p class="dash-greeting__sub">Account, preferences &amp; system configuration</p>
      </div>
    </div>

    <!-- ═══ PROFILE ═══ -->
    <div class="settings-section" data-reveal>
      <div class="settings-section__title">Profile</div>
      <div class="settings-card">
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Officer Name</div>
            <div class="settings-row__desc">As registered in the department roster</div>
          </div>
          <input type="text" class="settings-input" value="Insp. Trilochan Prasad" readonly />
        </div>
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Badge ID</div>
            <div class="settings-row__desc">Unique officer identification number</div>
          </div>
          <input type="text" class="settings-input" value="TI-KA-2847" readonly />
        </div>
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Department</div>
            <div class="settings-row__desc">Assigned enforcement division</div>
          </div>
          <select class="filter-bar__select" id="settingsDept" style="min-width: 200px;">
            <option selected>Traffic Enforcement</option>
            <option>Highway Patrol</option>
            <option>Road Safety Division</option>
            <option>Accident Investigation</option>
          </select>
        </div>
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">City</div>
            <div class="settings-row__desc">Primary jurisdiction</div>
          </div>
          <select class="filter-bar__select" id="settingsCity" style="min-width: 200px;">
            <option selected>Bangalore</option>
            <option>Delhi</option>
            <option>Mumbai</option>
            <option>Pune</option>
            <option>Hyderabad</option>
            <option>Chennai</option>
            <option>Chandigarh</option>
          </select>
        </div>
      </div>
    </div>

    <!-- ═══ PREFERENCES ═══ -->
    <div class="settings-section" data-reveal>
      <div class="settings-section__title">Preferences</div>
      <div class="settings-card">
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Email Notifications</div>
            <div class="settings-row__desc">Receive daily case summary via email</div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" checked id="togEmail" />
            <span class="toggle-switch__track"></span>
            <span class="toggle-switch__thumb"></span>
          </label>
        </div>
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Push Notifications</div>
            <div class="settings-row__desc">Real-time alerts for high-priority cases</div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" checked id="togPush" />
            <span class="toggle-switch__track"></span>
            <span class="toggle-switch__thumb"></span>
          </label>
        </div>
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Sound Alerts</div>
            <div class="settings-row__desc">Audible notification for urgent cases</div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="togSound" />
            <span class="toggle-switch__track"></span>
            <span class="toggle-switch__thumb"></span>
          </label>
        </div>
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Default Priority Filter</div>
            <div class="settings-row__desc">Pre-filter case queue on load</div>
          </div>
          <select class="filter-bar__select" id="settingsPriority" style="min-width: 160px;">
            <option value="all" selected>All Priorities</option>
            <option value="high">High Only</option>
            <option value="medium">Medium &amp; Above</option>
          </select>
        </div>
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Auto-approve AI Confidence &gt; 98%</div>
            <div class="settings-row__desc">Automatically approve cases with very high AI confidence</div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="togAutoApprove" />
            <span class="toggle-switch__track"></span>
            <span class="toggle-switch__thumb"></span>
          </label>
        </div>
      </div>
    </div>

    <!-- ═══ SECURITY ═══ -->
    <div class="settings-section" data-reveal>
      <div class="settings-section__title">Security</div>
      <div class="settings-card">
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Change Password</div>
            <div class="settings-row__desc">Update your account password</div>
          </div>
          <button class="settings-btn settings-btn--ghost" id="changePassBtn">Change Password</button>
        </div>
        <div id="passwordForm" style="display: none; padding: 16px 0; border-bottom: 1px solid var(--gray-50);">
          <div style="display: flex; flex-direction: column; gap: 12px; max-width: 320px;">
            <input type="password" class="settings-input" id="currentPass" placeholder="Current password" style="width: 100%;" />
            <input type="password" class="settings-input" id="newPass" placeholder="New password (min 6 chars)" style="width: 100%;" />
            <input type="password" class="settings-input" id="confirmPass" placeholder="Confirm new password" style="width: 100%;" />
            <div style="display: flex; gap: 8px;">
              <button class="settings-btn settings-btn--primary" id="savePassBtn">Update Password</button>
              <button class="settings-btn settings-btn--ghost" id="cancelPassBtn">Cancel</button>
            </div>
          </div>
        </div>
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Last Login</div>
            <div class="settings-row__desc">Most recent session activity</div>
          </div>
          <span class="settings-row__value" id="lastLogin">Feb 12, 2026 — 09:14 AM</span>
        </div>
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Active Sessions</div>
            <div class="settings-row__desc">Currently logged in devices</div>
          </div>
          <span class="settings-row__value">1 device <span style="color: var(--green-500);">●</span></span>
        </div>
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Two-Factor Authentication</div>
            <div class="settings-row__desc">Additional security layer for account access</div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" checked id="tog2FA" />
            <span class="toggle-switch__track"></span>
            <span class="toggle-switch__thumb"></span>
          </label>
        </div>
      </div>
    </div>

    <!-- ═══ SYSTEM INFO ═══ -->
    <div class="settings-section" data-reveal>
      <div class="settings-section__title">System Information</div>
      <div class="settings-card">
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">AI Model Version</div>
            <div class="settings-row__desc">Current violation detection model</div>
          </div>
          <span class="sys-badge sys-badge--info">SARAL-AI v3.2.1</span>
        </div>
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Platform Version</div>
            <div class="settings-row__desc">SARAL Authority Dashboard build</div>
          </div>
          <span class="settings-row__value settings-row__value--muted">v2.4.0-prod</span>
        </div>
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Audit Logging</div>
            <div class="settings-row__desc">All officer actions logged for compliance</div>
          </div>
          <span class="sys-badge sys-badge--active">
            <svg width="10" height="10" viewBox="0 0 10 10" fill="none"><circle cx="5" cy="5" r="3" fill="currentColor"/></svg>
            Enabled
          </span>
        </div>
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Data Retention Policy</div>
            <div class="settings-row__desc">Evidence retention period per CCTNS guidelines</div>
          </div>
          <span class="settings-row__value settings-row__value--muted">7 years</span>
        </div>
        <div class="settings-row">
          <div class="settings-row__info">
            <div class="settings-row__label">Last System Sync</div>
            <div class="settings-row__desc">Data synchronization with central server</div>
          </div>
          <span class="settings-row__value settings-row__value--muted">2 minutes ago</span>
        </div>
      </div>
    </div>

    <!-- Save Actions -->
    <div style="display: flex; gap: 12px; margin-top: 8px; padding-bottom: 40px;" data-reveal>
      <button class="settings-btn settings-btn--primary" id="saveSettingsBtn">Save Changes</button>
      <button class="settings-btn settings-btn--ghost" id="resetSettingsBtn">Reset to Default</button>
    </div>
  </main>

  <script src="js/store.js"></script>
  <script src="js/auth.js"></script>
  <script>SaralAuth.requireAuth('authority');</script>
  <script src="js/dashboard.js"></script>
  <script>
    (function () {
      'use strict';

      /* ─── SETTINGS PERSISTENCE ─── */
      const SETTINGS_KEY = 'saral_authority_settings';

      function getSettings() {
        try {
          return JSON.parse(localStorage.getItem(SETTINGS_KEY)) || {};
        } catch { return {}; }
      }

      function saveSettings(data) {
        localStorage.setItem(SETTINGS_KEY, JSON.stringify(data));
      }

      // Load saved settings
      const saved = getSettings();
      if (saved.dept) document.getElementById('settingsDept').value = saved.dept;
      if (saved.city) document.getElementById('settingsCity').value = saved.city;
      if (saved.priority) document.getElementById('settingsPriority').value = saved.priority;
      if (saved.emailNotif !== undefined) document.getElementById('togEmail').checked = saved.emailNotif;
      if (saved.pushNotif !== undefined) document.getElementById('togPush').checked = saved.pushNotif;
      if (saved.soundAlert !== undefined) document.getElementById('togSound').checked = saved.soundAlert;
      if (saved.autoApprove !== undefined) document.getElementById('togAutoApprove').checked = saved.autoApprove;
      if (saved.twoFA !== undefined) document.getElementById('tog2FA').checked = saved.twoFA;

      // Save button
      document.getElementById('saveSettingsBtn').addEventListener('click', function () {
        const data = {
          dept: document.getElementById('settingsDept').value,
          city: document.getElementById('settingsCity').value,
          priority: document.getElementById('settingsPriority').value,
          emailNotif: document.getElementById('togEmail').checked,
          pushNotif: document.getElementById('togPush').checked,
          soundAlert: document.getElementById('togSound').checked,
          autoApprove: document.getElementById('togAutoApprove').checked,
          twoFA: document.getElementById('tog2FA').checked,
        };
        saveSettings(data);
        if (typeof SaralToast !== 'undefined') SaralToast.show('Settings saved successfully', 'success');
      });

      // Reset button
      document.getElementById('resetSettingsBtn').addEventListener('click', function () {
        localStorage.removeItem(SETTINGS_KEY);
        document.getElementById('settingsDept').selectedIndex = 0;
        document.getElementById('settingsCity').selectedIndex = 0;
        document.getElementById('settingsPriority').selectedIndex = 0;
        document.getElementById('togEmail').checked = true;
        document.getElementById('togPush').checked = true;
        document.getElementById('togSound').checked = false;
        document.getElementById('togAutoApprove').checked = false;
        document.getElementById('tog2FA').checked = true;
        if (typeof SaralToast !== 'undefined') SaralToast.show('Settings reset to default', 'info');
      });

      /* ─── CHANGE PASSWORD ─── */
      const changePassBtn = document.getElementById('changePassBtn');
      const passwordForm = document.getElementById('passwordForm');
      const savePassBtn = document.getElementById('savePassBtn');
      const cancelPassBtn = document.getElementById('cancelPassBtn');

      changePassBtn.addEventListener('click', function () {
        passwordForm.style.display = passwordForm.style.display === 'none' ? 'block' : 'none';
      });

      cancelPassBtn.addEventListener('click', function () {
        passwordForm.style.display = 'none';
        document.getElementById('currentPass').value = '';
        document.getElementById('newPass').value = '';
        document.getElementById('confirmPass').value = '';
      });

      savePassBtn.addEventListener('click', function () {
        const current = document.getElementById('currentPass').value;
        const newP = document.getElementById('newPass').value;
        const confirm = document.getElementById('confirmPass').value;

        if (!current || !newP || !confirm) {
          if (typeof SaralToast !== 'undefined') SaralToast.show('All password fields are required', 'error');
          return;
        }

        // Verify current password
        const user = SaralAuth.getUser();
        const users = JSON.parse(localStorage.getItem('saral_users') || '[]');
        const match = users.find(u => u.email === user.email && u.password === current);
        if (!match) {
          if (typeof SaralToast !== 'undefined') SaralToast.show('Current password is incorrect', 'error');
          return;
        }

        if (newP.length < 6) {
          if (typeof SaralToast !== 'undefined') SaralToast.show('New password must be at least 6 characters', 'error');
          return;
        }
        if (newP !== confirm) {
          if (typeof SaralToast !== 'undefined') SaralToast.show('New passwords do not match', 'error');
          return;
        }

        // Update password
        match.password = newP;
        localStorage.setItem('saral_users', JSON.stringify(users));

        passwordForm.style.display = 'none';
        document.getElementById('currentPass').value = '';
        document.getElementById('newPass').value = '';
        document.getElementById('confirmPass').value = '';
        if (typeof SaralToast !== 'undefined') SaralToast.show('Password updated successfully', 'success');
      });

      /* ─── TOGGLE FEEDBACK ─── */
      document.querySelectorAll('.toggle-switch input').forEach(tog => {
        tog.addEventListener('change', function () {
          const label = this.closest('.settings-row').querySelector('.settings-row__label').textContent;
          const state = this.checked ? 'enabled' : 'disabled';
          if (typeof SaralToast !== 'undefined') SaralToast.show(label + ' ' + state, 'info');
        });
      });

    })();
  </script>
</body>
</html>
